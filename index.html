<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</title>

<style>
:root {
  --primary-color: #4facfe;
  --secondary-color: #00f2fe;
  --dark-bg: #0f2027;
  --light-bg: rgba(255, 255, 255, 0.1);
  --success-color: #2ecc71;
  --error-color: #e74c3c;
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.85);
  --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* { 
  box-sizing: border-box; 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: var(--dark-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: auto;
  padding: 20px;
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ */
.mode-switcher {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
}

.mode-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  transition: var(--transition-smooth);
}

.mode-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 30px;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.card {
  padding: 30px;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: var(--text-primary);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.card h2 {
  margin: 0 0 20px 0;
  font-size: 24px;
  color: var(--primary-color);
  text-align: center;
}

/* –§–æ—Ä–º—ã */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-secondary);
}

input[type="text"],
input[type="file"],
textarea {
  width: 100%;
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
  font-size: 15px;
  transition: var(--transition-smooth);
}

input[type="text"]:focus,
textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
}

textarea {
  min-height: 80px;
  resize: vertical;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-smooth);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
}

.btn-small {
  padding: 8px 16px;
  font-size: 14px;
}

.btn-download {
  background: rgba(46, 204, 113, 0.2);
  color: var(--success-color);
  border: 1px solid rgba(46, 204, 113, 0.3);
}

.btn-download:hover {
  background: rgba(46, 204, 113, 0.3);
}

/* –°–ø–∏—Å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
.documents-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 10px;
}

.document-item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 15px;
  transition: var(--transition-smooth);
}

.document-item:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.2);
}

.document-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.document-title {
  font-weight: 600;
  color: var(--primary-color);
  font-size: 16px;
}

.document-user {
  font-size: 12px;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 8px;
}

.document-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.document-info {
  flex: 1;
}

.document-description {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 5px;
}

.document-date {
  font-size: 12px;
  color: var(--text-secondary);
  opacity: 0.7;
}

.document-actions {
  display: flex;
  gap: 8px;
}

.document-files {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px dashed rgba(255, 255, 255, 0.1);
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 8px;
  margin-bottom: 5px;
}

.file-info {
  flex: 1;
}

.file-name {
  font-size: 14px;
  font-weight: 500;
}

.file-size {
  font-size: 12px;
  color: var(--text-secondary);
}

.file-actions {
  display: flex;
  gap: 5px;
}

/* –°—Ç–∞—Ç—É—Å */
.status {
  padding: 12px;
  border-radius: 12px;
  margin: 15px 0;
  text-align: center;
  font-weight: 500;
}

.status-success {
  background: rgba(46, 204, 113, 0.15);
  color: var(--success-color);
  border: 1px solid rgba(46, 204, 113, 0.3);
}

.status-error {
  background: rgba(231, 76, 60, 0.15);
  color: var(--error-color);
  border: 1px solid rgba(231, 76, 60, 0.3);
}

.status-info {
  background: rgba(52, 152, 219, 0.15);
  color: #3498db;
  border: 1px solid rgba(52, 152, 219, 0.3);
}

.status-warning {
  background: rgba(243, 156, 18, 0.15);
  color: #f39c12;
  border: 1px solid rgba(243, 156, 18, 0.3);
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
.progress-container {
  margin: 20px 0;
  display: none;
}

.progress-container.visible {
  display: block;
  animation: fadeIn 0.3s ease;
}

.progress-bar {
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  text-align: center;
  font-size: 14px;
  color: var(--text-secondary);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal.active {
  display: flex;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: var(--dark-bg);
  border-radius: 20px;
  padding: 30px;
  max-width: 500px;
  width: 100%;
  border: 1px solid rgba(255, 255, 255, 0.15);
  max-height: 90vh;
  overflow-y: auto;
}

/* –£—Ç–∏–ª–∏—Ç—ã */
.hidden {
  display: none !important;
}

.text-center {
  text-align: center;
}

.mt-20 {
  margin-top: 20px;
}

.mb-20 {
  margin-bottom: 20px;
}

.file-size-warning {
  font-size: 12px;
  color: #ffa726;
  margin-top: 4px;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .container {
    max-width: 100%;
  }
  
  .card {
    padding: 20px;
  }
  
  .document-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .document-actions {
    width: 100%;
    justify-content: flex-end;
  }
  
  .file-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .file-actions {
    width: 100%;
    justify-content: flex-end;
  }
}
</style>
</head>

<body>

<div class="mode-switcher">
  <button class="mode-btn" id="modeToggle">–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞</button>
</div>

<div class="container">
  <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <div id="userInterface">
    <div class="card">
      <h2>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h2>
      
      <div class="form-group">
        <label>–í–∞—à–µ –∏–º—è (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)</label>
        <input type="text" id="userName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
      </div>
      
      <div class="form-group">
        <label>–î–æ–∫—É–º–µ–Ω—Ç 1 (–º–∞–∫—Å. 1MB)</label>
        <input type="file" id="file1" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
        <input type="text" id="title1" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ 1" class="mt-20">
      </div>
      
      <div class="form-group">
        <label>–î–æ–∫—É–º–µ–Ω—Ç 2 (–º–∞–∫—Å. 1MB)</label>
        <input type="file" id="file2" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
        <input type="text" id="title2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ 2" class="mt-20">
      </div>
      
      <div class="form-group">
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <textarea id="userComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
      </div>
      
      <button class="btn btn-primary" id="submitBtn" onclick="uploadDocuments()" disabled>
        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
      </button>
      
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
      
      <div class="status" id="status">
        –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
      </div>
    </div>
    
    <div class="card">
      <h2>üì• –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</h2>
      <div id="receivedDocuments" class="documents-list">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã -->
      </div>
      <div class="text-center mt-20">
        <button class="btn btn-secondary btn-small" onclick="clearUserData()">–û—á–∏—Å—Ç–∏—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ</button>
      </div>
    </div>
  </div>
  
  <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∞ -->
  <div id="adminInterface" class="hidden">
    <div class="card">
      <h2>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      <div class="mb-20">
        <button class="btn btn-secondary" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button class="btn btn-secondary" onclick="refreshAdminView()" style="margin-left: 10px;">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <div class="status status-info mt-20" id="adminStats">
          –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
        </div>
      </div>
      
      <div class="documents-list" id="adminDocumentsList">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ -->
<div class="modal" id="responseModal">
  <div class="modal-content">
    <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</h2>
    
    <div class="form-group">
      <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
      <input type="text" id="responseRecipient" readonly>
    </div>
    
    <div class="form-group">
      <label>–î–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–º–∞–∫—Å. 1MB)</label>
      <input type="file" id="responseFile" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
    </div>
    
    <div class="form-group">
      <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
      <textarea id="responseComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É..."></textarea>
    </div>
    
    <div class="form-group">
      <button class="btn btn-primary" onclick="sendResponse()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
      <button class="btn btn-secondary" onclick="closeModal()" style="margin-left: 10px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
    
    <div class="status" id="responseStatus"></div>
  </div>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentMode = 'user';
let currentUser = localStorage.getItem('document_user_id') || generateUserId();
let selectedUserId = null;
let selectedRequestId = null;
const MAX_FILE_SIZE = 1 * 1024 * 1024; // 1MB

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function generateUserId() {
  const id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
  localStorage.setItem('document_user_id', id);
  return id;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
  console.log('–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
  
  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const savedName = localStorage.getItem('document_user_name');
  if (savedName) {
    document.getElementById('userName').value = savedName;
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
  checkFormValidity();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  loadReceivedDocuments();
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  document.getElementById('userName').addEventListener('input', function() {
    localStorage.setItem('document_user_name', this.value);
    checkFormValidity();
  });
  
  document.getElementById('title1').addEventListener('input', checkFormValidity);
  document.getElementById('title2').addEventListener('input', checkFormValidity);
  document.getElementById('file1').addEventListener('change', checkFormValidity);
  document.getElementById('file2').addEventListener('change', checkFormValidity);
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
  document.getElementById('modeToggle').addEventListener('click', toggleMode);
  
  // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  updateAdminStats();
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
function checkFormValidity() {
  const userName = document.getElementById('userName').value.trim();
  const file1 = document.getElementById('file1').files[0];
  const file2 = document.getElementById('file2').files[0];
  const title1 = document.getElementById('title1').value.trim();
  const title2 = document.getElementById('title2').value.trim();
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
  const file1Valid = file1 ? file1.size <= MAX_FILE_SIZE : false;
  const file2Valid = file2 ? file2.size <= MAX_FILE_SIZE : false;
  
  const isValid = userName && file1 && file2 && title1 && title2 && file1Valid && file2Valid;
  const submitBtn = document.getElementById('submitBtn');
  
  submitBtn.disabled = !isValid;
  
  if (isValid) {
    document.getElementById('status').textContent = '–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ';
    document.getElementById('status').className = 'status status-info';
  } else {
    document.getElementById('status').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 1MB)';
    document.getElementById('status').className = 'status';
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–¥–º–∏–Ω–∞
function updateAdminStats() {
  try {
    const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
    const responses = JSON.parse(localStorage.getItem('user_responses') || '{}');
    
    let responseCount = 0;
    for (const userId in responses) {
      responseCount += responses[userId].length;
    }
    
    const dataSize = (JSON.stringify(localStorage).length / 1024).toFixed(1);
    
    const statsElement = document.getElementById('adminStats');
    if (statsElement) {
      let statsHTML = `–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${docs.length} | –í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: ${responseCount} | –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: ${dataSize} KB`;
      
      if (parseFloat(dataSize) > 5000) { // –ë–æ–ª–µ–µ 5MB
        statsHTML += `<br><span style="color: #e74c3c; font-size: 12px;">‚ö† –í–Ω–∏–º–∞–Ω–∏–µ: —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5MB. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.</span>`;
      }
      
      statsElement.innerHTML = statsHTML;
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
  }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∞
function toggleMode() {
  console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞, —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:', currentMode);
  
  if (currentMode === 'user') {
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É
    const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:');
    
    if (password === 'admin') { // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–µ–º–æ
      console.log('–ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ –∞–¥–º–∏–Ω–∫—É');
      currentMode = 'admin';
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      document.getElementById('userInterface').classList.add('hidden');
      document.getElementById('adminInterface').classList.remove('hidden');
      document.getElementById('modeToggle').textContent = '–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –∞–¥–º–∏–Ω–∫—É
      loadAdminDocuments();
      updateAdminStats();
      
      console.log('–ê–¥–º–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    } else if (password !== null) {
      alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å: admin');
    }
  } else {
    console.log('–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ —Ä–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    currentMode = 'user';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Å–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É
    document.getElementById('adminInterface').classList.add('hidden');
    document.getElementById('userInterface').classList.remove('hidden');
    document.getElementById('modeToggle').textContent = '–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞';
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    loadReceivedDocuments();
    
    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω');
  }
}

// –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ DataURL
function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    if (!file) {
      reject(new Error('–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω'));
      return;
    }
    
    if (file.size > MAX_FILE_SIZE) {
      reject(new Error(`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (${(file.size / (1024 * 1024)).toFixed(2)} MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1MB`));
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      resolve({
        name: file.name,
        size: file.size,
        type: file.type,
        data: e.target.result
      });
    };
    reader.onerror = function(e) {
      reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
    };
    reader.readAsDataURL(file);
  });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
async function uploadDocuments() {
  console.log('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤');
  
  const userName = document.getElementById('userName').value.trim();
  const file1 = document.getElementById('file1').files[0];
  const file2 = document.getElementById('file2').files[0];
  const title1 = document.getElementById('title1').value.trim();
  const title2 = document.getElementById('title2').value.trim();
  const comment = document.getElementById('userComment').value.trim();
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º—É –µ—â—ë —Ä–∞–∑ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  if (!userName || !file1 || !file2 || !title1 || !title2) {
    showStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π', 'error');
    return;
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
  const progressContainer = document.getElementById('progressContainer');
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  const status = document.getElementById('status');
  
  progressContainer.classList.add('visible');
  status.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤...';
  status.className = 'status status-info';
  
  try {
    // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    let progress = 0;
    const progressInterval = setInterval(() => {
      progress += 10;
      if (progress > 90) {
        clearInterval(progressInterval);
        return;
      }
      progressFill.style.width = progress + '%';
      progressText.textContent = progress + '%';
    }, 200);
    
    // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã –∫–∞–∫ DataURL
    status.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ 1...';
    const file1Data = await readFileAsDataURL(file1);
    
    status.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ 2...';
    const file2Data = await readFileAsDataURL(file2);
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
    saveDocumentToSystem(userName, currentUser, [
      { 
        ...file1Data,
        title: title1
      },
      { 
        ...file2Data,
        title: title2
      }
    ], comment);
    
    clearInterval(progressInterval);
    progressFill.style.width = '100%';
    progressText.textContent = '100%';
    
    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    document.getElementById('file1').value = '';
    document.getElementById('file2').value = '';
    document.getElementById('title1').value = '';
    document.getElementById('title2').value = '';
    document.getElementById('userComment').value = '';
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
    setTimeout(() => {
      progressContainer.classList.remove('visible');
      progressFill.style.width = '0%';
      progressText.textContent = '0%';
    }, 1000);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
    updateAdminStats();
    
    if (currentMode === 'admin') {
      loadAdminDocuments();
    }
    
    showStatus('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.', 'success');
    checkFormValidity();
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', error);
    showStatus(`‚ùå ${error.message}`, 'error');
    progressContainer.classList.remove('visible');
    progressFill.style.width = '0%';
    progressText.textContent = '0%';
  }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
function saveDocumentToSystem(userName, userId, files, comment) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    const existingDocs = JSON.parse(localStorage.getItem('document_system') || '[]');
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    const newDoc = {
      id: 'doc_' + Date.now(),
      userId: userId,
      userName: userName,
      files: files,
      comment: comment,
      date: new Date().toISOString(),
      status: 'pending',
      responses: []
    };
    
    console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç:', newDoc);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º—É
    existingDocs.push(newDoc);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ localStorage
    localStorage.setItem('document_system', JSON.stringify(existingDocs));
    
    console.log('–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', existingDocs.length);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
    throw error;
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
function loadAdminDocuments() {
  console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –∞–¥–º–∏–Ω–∫—É');
  
  const container = document.getElementById('adminDocumentsList');
  
  try {
    const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
    console.log('–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', docs.length);
    
    if (docs.length === 0) {
      container.innerHTML = '<div class="text-center">–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã.</div>';
      return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    docs.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    let html = '';
    
    docs.forEach((doc, index) => {
      const date = new Date(doc.date).toLocaleString('ru-RU');
      const fileCount = doc.files ? doc.files.length : 0;
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–∞—Ö
      const filesHtml = doc.files ? doc.files.map((file, idx) => {
        const sizeMB = file.size ? (file.size / (1024 * 1024)).toFixed(2) : '0.00';
        return `
          <div class="file-item">
            <div class="file-info">
              <div class="file-name">${idx + 1}. ${file.title} - ${file.name}</div>
              <div class="file-size">${sizeMB} MB</div>
            </div>
            <div class="file-actions">
              <button class="btn btn-download btn-small" onclick="downloadAdminFile('${doc.id}', ${idx})">
                üì• –°–∫–∞—á–∞—Ç—å
              </button>
            </div>
          </div>
        `;
      }).join('') : '';
      
      html += `
        <div class="document-item">
          <div class="document-header">
            <div class="document-title">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç: ${doc.userName}</div>
            <div class="document-user">ID: ${doc.userId.substring(0, 12)}...</div>
          </div>
          <div class="document-content">
            <div class="document-info">
              <div class="document-description">
                <strong>${fileCount} —Ñ–∞–π–ª${fileCount > 1 ? '–∞' : ''}</strong>
                ${doc.comment ? `<br><small>üí¨ ${doc.comment}</small>` : ''}
              </div>
              <div class="document-date">üìÖ ${date}</div>
              <div class="document-files">
                ${filesHtml}
              </div>
            </div>
            <div class="document-actions">
              <button class="btn btn-primary btn-small" onclick="openResponseModal('${doc.userId}', '${doc.id}', '${doc.userName}')">
                üì§ –û—Ç–≤–µ—Ç–∏—Ç—å
              </button>
              <button class="btn btn-secondary btn-small" onclick="deleteDocument('${doc.id}')">
                üóë –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;
    console.log('–î–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤ –∞–¥–º–∏–Ω–∫–µ');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫—É:', error);
    container.innerHTML = '<div class="status status-error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>';
  }
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
function downloadAdminFile(docId, fileIndex) {
  try {
    const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
    const doc = docs.find(d => d.id === docId);
    
    if (!doc) {
      alert('–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }
    
    if (!doc.files || !doc.files[fileIndex]) {
      alert('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }
    
    const file = doc.files[fileIndex];
    
    if (!file.data) {
      alert('–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
      return;
    }
    
    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const link = document.createElement('a');
    link.href = file.data;
    link.download = `${doc.userName}_${file.title}_${file.name}`;
    link.style.display = 'none';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log('–§–∞–π–ª —Å–∫–∞—á–∞–Ω:', file.name);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞');
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
function deleteDocument(docId) {
  if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
    try {
      const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
      const filteredDocs = docs.filter(d => d.id !== docId);
      localStorage.setItem('document_system', JSON.stringify(filteredDocs));
      
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
      loadAdminDocuments();
      updateAdminStats();
      
      showStatus('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
    }
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –∞–¥–º–∏–Ω–∞
function refreshAdminView() {
  console.log('–û–±–Ω–æ–≤–ª—è–µ–º –∞–¥–º–∏–Ω–∫—É');
  loadAdminDocuments();
  updateAdminStats();
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
function openResponseModal(userId, requestId, userName) {
  console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', userName);
  
  selectedUserId = userId;
  selectedRequestId = requestId;
  
  document.getElementById('responseRecipient').value = `${userName}`;
  document.getElementById('responseModal').classList.add('active');
  document.getElementById('responseFile').value = '';
  document.getElementById('responseComment').value = '';
  document.getElementById('responseStatus').textContent = '';
  document.getElementById('responseStatus').className = 'status';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeModal() {
  document.getElementById('responseModal').classList.remove('active');
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
async function sendResponse() {
  const fileInput = document.getElementById('responseFile');
  const comment = document.getElementById('responseComment').value.trim();
  const statusElement = document.getElementById('responseStatus');
  
  if (!fileInput.files[0]) {
    statusElement.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏';
    statusElement.className = 'status status-error';
    return;
  }
  
  const file = fileInput.files[0];
  
  if (file.size > MAX_FILE_SIZE) {
    statusElement.textContent = `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (${(file.size / (1024 * 1024)).toFixed(2)} MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1MB`;
    statusElement.className = 'status status-error';
    return;
  }
  
  try {
    statusElement.textContent = '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...';
    statusElement.className = 'status status-info';
    
    // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ DataURL
    const fileData = await readFileAsDataURL(file);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
    const allResponses = JSON.parse(localStorage.getItem('user_responses') || '{}');
    
    if (!allResponses[selectedUserId]) {
      allResponses[selectedUserId] = [];
    }
    
    allResponses[selectedUserId].push({
      requestId: selectedRequestId,
      fileName: file.name,
      fileSize: file.size,
      fileType: file.type,
      fileData: fileData.data, // –°–æ—Ö—Ä–∞–Ω—è–µ–º DataURL —Ñ–∞–π–ª–∞
      comment: comment,
      date: new Date().toISOString(),
      from: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
    });
    
    localStorage.setItem('user_responses', JSON.stringify(allResponses));
    
    statusElement.textContent = '‚úÖ –û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!';
    statusElement.className = 'status status-success';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateAdminStats();
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      closeModal();
    }, 2000);
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞:', error);
    statusElement.textContent = `‚ùå ${error.message}`;
    statusElement.className = 'status status-error';
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function loadReceivedDocuments() {
  console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  
  const container = document.getElementById('receivedDocuments');
  
  try {
    const allResponses = JSON.parse(localStorage.getItem('user_responses') || '{}');
    const userResponses = allResponses[currentUser] || [];
    
    console.log('–ù–∞–π–¥–µ–Ω–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userResponses.length);
    
    if (userResponses.length === 0) {
      container.innerHTML = '<div class="text-center">–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤–∞–º –¥–æ–∫—É–º–µ–Ω—Ç—ã.</div>';
      return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    userResponses.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    let html = '';
    
    userResponses.forEach((item, index) => {
      const date = new Date(item.date).toLocaleString('ru-RU');
      const sizeMB = item.fileSize ? (item.fileSize / (1024 * 1024)).toFixed(2) : '?';
      
      html += `
        <div class="document-item">
          <div class="document-header">
            <div class="document-title">üì§ –û—Ç–≤–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
            <div class="document-date">${date}</div>
          </div>
          <div class="document-content">
            <div class="document-info">
              <div class="document-description">
                <strong>–§–∞–π–ª:</strong> ${item.fileName} (${sizeMB} MB)
                ${item.comment ? `<br><small>üí¨ ${item.comment}</small>` : ''}
              </div>
            </div>
            <div class="document-actions">
              <button class="btn btn-download btn-small" onclick="downloadReceivedFile(${index})">
                üì• –°–∫–∞—á–∞—Ç—å
              </button>
            </div>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–≤–µ—Ç–æ–≤:', error);
    container.innerHTML = '<div class="status status-error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–≤–µ—Ç–æ–≤</div>';
  }
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
function downloadReceivedFile(responseIndex) {
  try {
    const allResponses = JSON.parse(localStorage.getItem('user_responses') || '{}');
    const userResponses = allResponses[currentUser] || [];
    
    if (!userResponses[responseIndex]) {
      alert('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }
    
    const response = userResponses[responseIndex];
    
    if (!response.fileData) {
      alert('–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
      return;
    }
    
    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const link = document.createElement('a');
    link.href = response.fileData;
    link.download = `–û—Ç–≤–µ—Ç_–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞_${response.fileName}`;
    link.style.display = 'none';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log('–§–∞–π–ª —Å–∫–∞—á–∞–Ω:', response.fileName);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞');
  }
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
function clearAllData() {
  if (confirm('–í–ù–ò–ú–ê–ù–ò–ï: –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –æ—Ç–≤–µ—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
    localStorage.clear();
    alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞.');
    location.reload();
  }
}

// –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function clearUserData() {
  if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –≤–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –æ—Ç–≤–µ—Ç—ã? –≠—Ç–æ –Ω–µ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.')) {
    try {
      // –£–¥–∞–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
      const filteredDocs = docs.filter(doc => doc.userId !== currentUser);
      localStorage.setItem('document_system', JSON.stringify(filteredDocs));
      
      // –£–¥–∞–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const allResponses = JSON.parse(localStorage.getItem('user_responses') || '{}');
      delete allResponses[currentUser];
      localStorage.setItem('user_responses', JSON.stringify(allResponses));
      
      alert('–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!');
      loadReceivedDocuments();
      updateAdminStats();
      
      // –ï—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      if (currentMode === 'admin') {
        loadAdminDocuments();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö');
    }
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
function showStatus(message, type = 'info') {
  const status = document.getElementById('status');
  if (status) {
    status.textContent = message;
    status.className = `status status-${type}`;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    if (type === 'success') {
      setTimeout(() => {
        if (status.textContent === message) {
          status.textContent = '';
          status.className = 'status';
        }
      }, 5000);
    }
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Service Worker –¥–ª—è PWA
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register(
    URL.createObjectURL(new Blob([`
      self.addEventListener('fetch', e => {});
    `], { type: "text/javascript" }))
  );
}
</script>

</body>
</html>
