<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</title>

<!-- PWA -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Document Exchange&quot;,
  &quot;short_name&quot;:&quot;Docs&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#0f2027&quot;,
  &quot;theme_color&quot;:&quot;#4facfe&quot;
}">
<meta name="theme-color" content="#4facfe">

<style>
:root {
  --primary-color: #4facfe;
  --secondary-color: #00f2fe;
  --dark-bg: #0f2027;
  --light-bg: rgba(255, 255, 255, 0.1);
  --success-color: #2ecc71;
  --error-color: #e74c3c;
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.85);
  --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* { 
  box-sizing: border-box; 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: var(--dark-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: auto;
  padding: 20px;
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ */
.mode-switcher {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
}

.mode-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  transition: var(--transition-smooth);
}

.mode-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 30px;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.card {
  padding: 30px;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: var(--text-primary);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.card h2 {
  margin: 0 0 20px 0;
  font-size: 24px;
  color: var(--primary-color);
  text-align: center;
}

/* –§–æ—Ä–º—ã */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-secondary);
}

input[type="text"],
input[type="file"],
textarea {
  width: 100%;
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
  font-size: 15px;
  transition: var(--transition-smooth);
}

input[type="text"]:focus,
textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
}

textarea {
  min-height: 80px;
  resize: vertical;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-smooth);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
}

.btn-small {
  padding: 8px 16px;
  font-size: 14px;
}

/* –°–ø–∏—Å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
.documents-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 10px;
}

.document-item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 15px;
  transition: var(--transition-smooth);
}

.document-item:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.2);
}

.document-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.document-title {
  font-weight: 600;
  color: var(--primary-color);
  font-size: 16px;
}

.document-user {
  font-size: 12px;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 8px;
}

.document-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.document-info {
  flex: 1;
}

.document-description {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 5px;
}

.document-date {
  font-size: 12px;
  color: var(--text-secondary);
  opacity: 0.7;
}

.document-actions {
  display: flex;
  gap: 8px;
}

/* –°—Ç–∞—Ç—É—Å */
.status {
  padding: 12px;
  border-radius: 12px;
  margin: 15px 0;
  text-align: center;
  font-weight: 500;
}

.status-success {
  background: rgba(46, 204, 113, 0.15);
  color: var(--success-color);
  border: 1px solid rgba(46, 204, 113, 0.3);
}

.status-error {
  background: rgba(231, 76, 60, 0.15);
  color: var(--error-color);
  border: 1px solid rgba(231, 76, 60, 0.3);
}

.status-info {
  background: rgba(52, 152, 219, 0.15);
  color: #3498db;
  border: 1px solid rgba(52, 152, 219, 0.3);
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
.progress-container {
  margin: 20px 0;
  display: none;
}

.progress-container.visible {
  display: block;
  animation: fadeIn 0.3s ease;
}

.progress-bar {
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  text-align: center;
  font-size: 14px;
  color: var(--text-secondary);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal.active {
  display: flex;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: var(--dark-bg);
  border-radius: 20px;
  padding: 30px;
  max-width: 500px;
  width: 100%;
  border: 1px solid rgba(255, 255, 255, 0.15);
  max-height: 90vh;
  overflow-y: auto;
}

/* –£—Ç–∏–ª–∏—Ç—ã */
.hidden {
  display: none;
}

.text-center {
  text-align: center;
}

.mt-20 {
  margin-top: 20px;
}

.mb-20 {
  margin-bottom: 20px;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .container {
    max-width: 100%;
  }
  
  .card {
    padding: 20px;
  }
  
  .document-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .document-actions {
    width: 100%;
    justify-content: flex-end;
  }
}
</style>
</head>

<body>

<div class="mode-switcher">
  <button class="mode-btn" id="modeToggle">–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞</button>
</div>

<div class="container">
  <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <div id="userInterface">
    <div class="card">
      <h2>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h2>
      
      <div class="form-group">
        <label>–í–∞—à–µ –∏–º—è (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)</label>
        <input type="text" id="userName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
      </div>
      
      <div class="form-group">
        <label>–î–æ–∫—É–º–µ–Ω—Ç 1</label>
        <input type="file" id="file1">
        <input type="text" id="title1" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ 1" class="mt-20">
      </div>
      
      <div class="form-group">
        <label>–î–æ–∫—É–º–µ–Ω—Ç 2</label>
        <input type="file" id="file2">
        <input type="text" id="title2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ 2" class="mt-20">
      </div>
      
      <div class="form-group">
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <textarea id="userComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
      </div>
      
      <button class="btn btn-primary" id="submitBtn" onclick="uploadDocuments()" disabled>
        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
      </button>
      
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
      
      <div class="status" id="status">
        –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
      </div>
    </div>
    
    <div class="card">
      <h2>üì• –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</h2>
      <div id="receivedDocuments" class="documents-list">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã -->
      </div>
    </div>
  </div>
  
  <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∞ -->
  <div id="adminInterface" class="hidden">
    <div class="card">
      <h2>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      
      <div class="documents-list" id="adminDocumentsList">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ -->
<div class="modal" id="responseModal">
  <div class="modal-content">
    <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</h2>
    
    <div class="form-group">
      <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
      <input type="text" id="responseRecipient" readonly>
    </div>
    
    <div class="form-group">
      <label>–î–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
      <input type="file" id="responseFile">
    </div>
    
    <div class="form-group">
      <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
      <textarea id="responseComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É..."></textarea>
    </div>
    
    <div class="form-group">
      <button class="btn btn-primary" onclick="sendResponse()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
      <button class="btn btn-secondary" onclick="closeModal()" style="margin-left: 10px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
    
    <div class="status" id="responseStatus"></div>
  </div>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentMode = 'user';
let currentUser = localStorage.getItem('document_user_id') || generateUserId();
let selectedUserId = null;
let selectedRequestId = null;

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function generateUserId() {
  const id = 'user_' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('document_user_id', id);
  return id;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const savedName = localStorage.getItem('document_user_name');
  if (savedName) {
    document.getElementById('userName').value = savedName;
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
  checkFormValidity();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  loadReceivedDocuments();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞
  loadAdminDocuments();
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  document.getElementById('userName').addEventListener('input', function() {
    localStorage.setItem('document_user_name', this.value);
    checkFormValidity();
  });
  
  document.getElementById('title1').addEventListener('input', checkFormValidity);
  document.getElementById('title2').addEventListener('input', checkFormValidity);
  document.getElementById('file1').addEventListener('change', checkFormValidity);
  document.getElementById('file2').addEventListener('change', checkFormValidity);
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
  document.getElementById('modeToggle').addEventListener('click', toggleMode);
});

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∞
function toggleMode() {
  const modeBtn = document.getElementById('modeToggle');
  
  if (currentMode === 'user') {
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É
    const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:');
    if (password === 'admin123') { // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–µ–º–æ
      currentMode = 'admin';
      document.getElementById('userInterface').classList.add('hidden');
      document.getElementById('adminInterface').classList.remove('hidden');
      modeBtn.textContent = '–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
      loadAdminDocuments();
    }
  } else {
    currentMode = 'user';
    document.getElementById('userInterface').classList.remove('hidden');
    document.getElementById('adminInterface').classList.add('hidden');
    modeBtn.textContent = '–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞';
    loadReceivedDocuments();
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
function checkFormValidity() {
  const userName = document.getElementById('userName').value.trim();
  const file1 = document.getElementById('file1').files[0];
  const file2 = document.getElementById('file2').files[0];
  const title1 = document.getElementById('title1').value.trim();
  const title2 = document.getElementById('title2').value.trim();
  
  const isValid = userName && file1 && file2 && title1 && title2;
  const submitBtn = document.getElementById('submitBtn');
  
  submitBtn.disabled = !isValid;
  
  if (isValid) {
    document.getElementById('status').textContent = '–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ';
    document.getElementById('status').className = 'status status-info';
  } else {
    document.getElementById('status').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤';
    document.getElementById('status').className = 'status';
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
function uploadDocuments() {
  const userName = document.getElementById('userName').value.trim();
  const file1 = document.getElementById('file1').files[0];
  const file2 = document.getElementById('file2').files[0];
  const title1 = document.getElementById('title1').value.trim();
  const title2 = document.getElementById('title2').value.trim();
  const comment = document.getElementById('userComment').value.trim();
  
  if (!userName || !file1 || !file2 || !title1 || !title2) {
    showStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
  const progressContainer = document.getElementById('progressContainer');
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  const status = document.getElementById('status');
  
  progressContainer.classList.add('visible');
  status.textContent = '–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...';
  status.className = 'status status-info';
  
  // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  let progress = 0;
  const interval = setInterval(() => {
    progress += 10;
    progressFill.style.width = progress + '%';
    progressText.textContent = progress + '%';
    
    if (progress >= 100) {
      clearInterval(interval);
      
      // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–∞–∫ DataURL
      const reader1 = new FileReader();
      const reader2 = new FileReader();
      
      reader1.onload = function(e1) {
        reader2.onload = function(e2) {
          // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
          saveDocumentToSystem(userName, currentUser, [
            { file: e1.target.result, name: file1.name, title: title1 },
            { file: e2.target.result, name: file2.name, title: title2 }
          ], comment);
          
          // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
          document.getElementById('file1').value = '';
          document.getElementById('file2').value = '';
          document.getElementById('title1').value = '';
          document.getElementById('title2').value = '';
          document.getElementById('userComment').value = '';
          
          // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
          setTimeout(() => {
            progressContainer.classList.remove('visible');
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
          }, 1000);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ (–µ—Å–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∞)
          if (currentMode === 'admin') {
            loadAdminDocuments();
          }
          
          showStatus('–î–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.', 'success');
          checkFormValidity();
        };
        reader2.readAsDataURL(file2);
      };
      reader1.readAsDataURL(file1);
    }
  }, 200);
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ (localStorage)
function saveDocumentToSystem(userName, userId, files, comment) {
  // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
  const existingDocs = JSON.parse(localStorage.getItem('document_system') || '[]');
  
  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
  const newDoc = {
    id: 'doc_' + Date.now(),
    userId: userId,
    userName: userName,
    files: files,
    comment: comment,
    date: new Date().toISOString(),
    status: 'pending',
    responses: [] // –ú–∞—Å—Å–∏–≤ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –∞–¥–º–∏–Ω–∞
  };
  
  // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º—É
  existingDocs.push(newDoc);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ localStorage
  localStorage.setItem('document_system', JSON.stringify(existingDocs));
  
  // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
  const userDocs = JSON.parse(localStorage.getItem(`user_docs_${userId}`) || '[]');
  userDocs.push(newDoc.id);
  localStorage.setItem(`user_docs_${userId}`, JSON.stringify(userDocs));
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
function loadAdminDocuments() {
  const container = document.getElementById('adminDocumentsList');
  const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
  
  if (docs.length === 0) {
    container.innerHTML = '<div class="text-center">–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>';
    return;
  }
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
  docs.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  let html = '';
  
  docs.forEach(doc => {
    const date = new Date(doc.date).toLocaleString('ru-RU');
    const fileCount = doc.files ? doc.files.length : 0;
    
    html += `
      <div class="document-item">
        <div class="document-header">
          <div class="document-title">–î–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç: ${doc.userName}</div>
          <div class="document-user">${doc.userId}</div>
        </div>
        <div class="document-content">
          <div class="document-info">
            <div class="document-description">
              ${fileCount} —Ñ–∞–π–ª${fileCount > 1 ? '–∞' : ''} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
              ${doc.comment ? `<br><small>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${doc.comment}</small>` : ''}
            </div>
            <div class="document-date">${date}</div>
            <div class="document-files">
              ${doc.files ? doc.files.map((file, index) => 
                `<div style="font-size: 12px; margin-top: 5px;">
                  ${index + 1}. ${file.title} (${file.name})
                </div>`
              ).join('') : ''}
            </div>
          </div>
          <div class="document-actions">
            <button class="btn btn-secondary btn-small" onclick="downloadUserDocument('${doc.id}')">
              üì• –°–∫–∞—á–∞—Ç—å
            </button>
            <button class="btn btn-primary btn-small" onclick="openResponseModal('${doc.userId}', '${doc.id}', '${doc.userName}')">
              üì§ –û—Ç–≤–µ—Ç–∏—Ç—å
            </button>
          </div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function downloadUserDocument(docId) {
  const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
  const doc = docs.find(d => d.id === docId);
  
  if (!doc || !doc.files) {
    alert('–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }
  
  // –°–æ–∑–¥–∞–µ–º ZIP –∞—Ä—Ö–∏–≤ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (–≤ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ —Å–∫–∞—á–∏–≤–∞–µ–º –ø–æ –æ–¥–Ω–æ–º—É)
  doc.files.forEach((file, index) => {
    const link = document.createElement('a');
    link.href = file.file;
    link.download = `${doc.userName}_${file.title || '–¥–æ–∫—É–º–µ–Ω—Ç'}_${index + 1}_${file.name}`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
  
  alert(`–°–∫–∞—á–∞–Ω–æ ${doc.files.length} —Ñ–∞–π–ª${doc.files.length > 1 ? '–∞' : ''} –æ—Ç ${doc.userName}`);
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
function openResponseModal(userId, requestId, userName) {
  selectedUserId = userId;
  selectedRequestId = requestId;
  
  document.getElementById('responseRecipient').value = `${userName} (${userId})`;
  document.getElementById('responseModal').classList.add('active');
  document.getElementById('responseFile').value = '';
  document.getElementById('responseComment').value = '';
  document.getElementById('responseStatus').textContent = '';
  document.getElementById('responseStatus').className = 'status';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeModal() {
  document.getElementById('responseModal').classList.remove('active');
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
function sendResponse() {
  const fileInput = document.getElementById('responseFile');
  const comment = document.getElementById('responseComment').value.trim();
  const statusElement = document.getElementById('responseStatus');
  
  if (!fileInput.files[0]) {
    statusElement.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏';
    statusElement.className = 'status status-error';
    return;
  }
  
  const file = fileInput.files[0];
  const reader = new FileReader();
  
  reader.onload = function(e) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
    const docs = JSON.parse(localStorage.getItem('document_system') || '[]');
    const docIndex = docs.findIndex(d => d.id === selectedRequestId);
    
    if (docIndex !== -1) {
      if (!docs[docIndex].responses) {
        docs[docIndex].responses = [];
      }
      
      docs[docIndex].responses.push({
        file: e.target.result,
        fileName: file.name,
        comment: comment,
        date: new Date().toISOString()
      });
      
      docs[docIndex].status = 'answered';
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
      localStorage.setItem('document_system', JSON.stringify(docs));
      
      // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      saveResponseForUser(selectedUserId, selectedRequestId, {
        file: e.target.result,
        fileName: file.name,
        comment: comment,
        date: new Date().toISOString(),
        from: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
      });
      
      statusElement.textContent = '–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!';
      statusElement.className = 'status status-success';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
      loadAdminDocuments();
      
      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        closeModal();
      }, 2000);
    }
  };
  
  reader.readAsDataURL(file);
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function saveResponseForUser(userId, requestId, response) {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userResponses = JSON.parse(localStorage.getItem(`user_responses_${userId}`) || '[]');
  userResponses.push({
    requestId: requestId,
    response: response
  });
  localStorage.setItem(`user_responses_${userId}`, JSON.stringify(userResponses));
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function loadReceivedDocuments() {
  const container = document.getElementById('receivedDocuments');
  const responses = JSON.parse(localStorage.getItem(`user_responses_${currentUser}`) || '[]');
  
  if (responses.length === 0) {
    container.innerHTML = '<div class="text-center">–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>';
    return;
  }
  
  let html = '';
  
  responses.forEach(item => {
    const response = item.response;
    const date = new Date(response.date).toLocaleString('ru-RU');
    
    html += `
      <div class="document-item">
        <div class="document-header">
          <div class="document-title">–û—Ç–≤–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
          <div class="document-date">${date}</div>
        </div>
        <div class="document-content">
          <div class="document-info">
            <div class="document-description">
              –§–∞–π–ª: ${response.fileName}
              ${response.comment ? `<br><small>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${response.comment}</small>` : ''}
            </div>
          </div>
          <div class="document-actions">
            <button class="btn btn-primary btn-small" onclick="downloadResponse('${btoa(JSON.stringify(response))}')">
              üì• –°–∫–∞—á–∞—Ç—å
            </button>
          </div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function downloadResponse(responseData) {
  try {
    const response = JSON.parse(atob(responseData));
    
    if (response && response.file) {
      const link = document.createElement('a');
      link.href = response.file;
      link.download = `–û—Ç–≤–µ—Ç_–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞_${response.fileName}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞');
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
function showStatus(message, type = 'info') {
  const status = document.getElementById('status');
  status.textContent = message;
  status.className = `status status-${type}`;
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  if (type === 'success') {
    setTimeout(() => {
      if (status.textContent === message) {
        status.textContent = '';
        status.className = 'status';
      }
    }, 5000);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Service Worker –¥–ª—è PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register(
    URL.createObjectURL(new Blob([`
      self.addEventListener('fetch', e => {});
    `], { type: "text/javascript" }))
  );
}
</script>

</body>
</html>
